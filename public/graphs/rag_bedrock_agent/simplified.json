{
  "nodes": [
    {
      "id": "AWS Cloud",
      "type": "aws_container",
      "data": {
        "resource_name": "AWS Cloud",
        "resource_type": "aws_container",
        "resource_icon": "aws/Architecture-Group-Icons_07312025/AWS-Cloud-logo_32.svg"
      },
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "s3",
      "type": "service_container",
      "data": {
        "resource_name": "s3",
        "resource_type": "service_container",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Storage/48/Arch_Amazon-Simple-Storage-Service_48.svg"
      },
      "parentId": "AWS Cloud",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "lambda",
      "type": "service_container",
      "data": {
        "resource_name": "lambda",
        "resource_type": "service_container",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Compute/48/Arch_AWS-Lambda_48.svg"
      },
      "parentId": "AWS Cloud",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "cloudwatch",
      "type": "service_container",
      "data": {
        "resource_name": "cloudwatch",
        "resource_type": "service_container",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Management-Governance/48/Arch_Amazon-CloudWatch_48.svg"
      },
      "parentId": "AWS Cloud",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "sqs",
      "type": "service_container",
      "data": {
        "resource_name": "sqs",
        "resource_type": "service_container",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_App-Integration/48/Arch_Amazon-Simple-Queue-Service_48.svg"
      },
      "parentId": "AWS Cloud",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "opensearchserverless",
      "type": "service_container",
      "data": {
        "resource_name": "opensearchserverless",
        "resource_type": "service_container",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Analytics/48/Arch_Amazon-OpenSearch-Service_48.svg"
      },
      "parentId": "AWS Cloud",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "IAM",
      "type": "service_container",
      "data": {
        "resource_name": "IAM",
        "resource_type": "service_container",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Security-Identity-Compliance/48/Arch_AWS-Identity-and-Access-Management_48.svg"
      },
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "vpc",
      "type": "service_container",
      "data": {
        "resource_name": "vpc",
        "resource_type": "service_container",
        "resource_icon": "aws/Architecture-Group-Icons_07312025/Virtual-private-cloud-VPC_32.svg"
      },
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_iam_role.bedrock_iam_role",
      "type": "iam",
      "parentId": "IAM",
      "data": {
        "resource_type": "aws_iam_role",
        "resource_name": "bedrock_iam_role",
        "resource_service": "iam",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Security-Identity-Compliance/48/Arch_AWS-Identity-and-Access-Management_48.svg",
        "assume_role_policy": null,
        "name": "bedrock-agent-role-acme-prod",
        "policies": {}
      },
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_iam_role.bedrock_sample_kb_role",
      "type": "iam",
      "parentId": "IAM",
      "data": {
        "resource_type": "aws_iam_role",
        "resource_name": "bedrock_sample_kb_role",
        "resource_service": "iam",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Security-Identity-Compliance/48/Arch_AWS-Identity-and-Access-Management_48.svg",
        "name": "bedrock-kb-role-acme-prod",
        "assume_role_policy": null,
        "policies": {}
      },
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_iam_role.agent_lambda_role",
      "type": "iam",
      "parentId": "IAM",
      "data": {
        "resource_type": "aws_iam_role",
        "resource_name": "agent_lambda_role",
        "resource_service": "iam",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Security-Identity-Compliance/48/Arch_AWS-Identity-and-Access-Management_48.svg",
        "name": "bedrock-agent-lambda-role-acme-prod",
        "assume_role_policy": null,
        "policies": {}
      },
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_iam_role.bedrock_logging_role",
      "type": "iam",
      "parentId": "IAM",
      "data": {
        "resource_type": "aws_iam_role",
        "resource_name": "bedrock_logging_role",
        "resource_service": "iam",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Security-Identity-Compliance/48/Arch_AWS-Identity-and-Access-Management_48.svg",
        "assume_role_policy": null,
        "name": "bedrock-agent-invoke-role-acme-prod",
        "policies": {}
      },
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_vpc_endpoint.s3",
      "type": "resource",
      "data": {
        "resource_type": "aws_vpc_endpoint",
        "resource_name": "s3",
        "resource_service": "vpc",
        "resource_icon": "aws/Resource-Icons_07312025/Res_Networking-Content-Delivery/Res_Amazon-VPC_Endpoints_48.svg",
        "count": 1,
        "vpc_id": "vpc-047dd28296946f67c",
        "service_name": "com.amazonaws..s3",
        "vpc_endpoint_type": "Gateway",
        "has_security_groups": false,
        "sg_rules": [],
        "iam_role_id": null
      },
      "parentId": "vpc",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_s3_bucket.sample_kb_bucket",
      "type": "resource",
      "data": {
        "resource_type": "aws_s3_bucket",
        "resource_name": "sample_kb_bucket",
        "resource_service": "s3",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Storage/48/Arch_Amazon-Simple-Storage-Service_48.svg",
        "bucket": "kb-usw2-prod",
        "force_destroy": true,
        "has_security_groups": false,
        "sg_rules": [],
        "iam_role_id": null
      },
      "parentId": "s3",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_s3_bucket.sample_kb_logging_bucket",
      "type": "resource",
      "data": {
        "resource_type": "aws_s3_bucket",
        "resource_name": "sample_kb_logging_bucket",
        "resource_service": "s3",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Storage/48/Arch_Amazon-Simple-Storage-Service_48.svg",
        "bucket": "kb-accesslog-usw2-prod",
        "force_destroy": true,
        "has_security_groups": false,
        "sg_rules": [],
        "iam_role_id": null
      },
      "parentId": "s3",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_opensearchserverless_collection.sample_aoss_collection",
      "type": "resource",
      "data": {
        "resource_type": "aws_opensearchserverless_collection",
        "resource_name": "sample_aoss_collection",
        "resource_service": "opensearchserverless",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Analytics/48/Arch_Amazon-OpenSearch-Service_48.svg",
        "name": "aoss-collection-usw2-prod",
        "type": "VECTORSEARCH",
        "depends_on": [
          "${aws_opensearchserverless_access_policy.sample_kb_aoss_policy}",
          "${aws_opensearchserverless_security_policy.sample_kb_encryption_policy}",
          "${aws_opensearchserverless_security_policy.sample_kb_network_policy}"
        ],
        "has_security_groups": false,
        "sg_rules": [],
        "iam_role_id": null
      },
      "parentId": "opensearchserverless",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_cloudwatch_log_group.agent_invoke_log_group",
      "type": "resource",
      "data": {
        "resource_type": "aws_cloudwatch_log_group",
        "resource_name": "agent_invoke_log_group",
        "resource_service": "cloudwatch",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Management-Governance/48/Arch_Amazon-CloudWatch_48.svg",
        "name": "agent-invoke-log-bedrock-agent-usw2-prod",
        "retention_in_days": 365,
        "kms_key_id": "arn:aws:kms:us-west-2:XXXXXXXXXXXXX:key/1488f8c9-6443-4486-9927-8825278e3aad",
        "has_security_groups": false,
        "sg_rules": [],
        "iam_role_id": null
      },
      "parentId": "cloudwatch",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_sqs_queue.bi_chatbot_container_lambda_dql",
      "type": "resource",
      "data": {
        "resource_type": "aws_sqs_queue",
        "resource_name": "bi_chatbot_container_lambda_dql",
        "resource_service": "sqs",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_App-Integration/48/Arch_Amazon-Simple-Queue-Service_48.svg",
        "name": "bi-chatbot-container-lambda-dlq-acme-prod",
        "kms_master_key_id": "arn:aws:kms:us-west-2:XXXXXXXXXXXXX:key/1488f8c9-6443-4486-9927-8825278e3aad",
        "has_security_groups": false,
        "sg_rules": [],
        "iam_role_id": null
      },
      "parentId": "sqs",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_lambda_function.bi_chatbot_container_lambda",
      "type": "resource",
      "data": {
        "resource_type": "aws_lambda_function",
        "resource_name": "bi_chatbot_container_lambda",
        "resource_service": "lambda",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Compute/48/Arch_AWS-Lambda_48.svg",
        "function_name": "bi-chatbot-container-lambda-acme-prod",
        "handler": "lambda_function.lambda_handler",
        "runtime": "python3.12",
        "architectures": [
          "x86_64"
        ],
        "kms_key_arn": "arn:aws:kms:us-west-2:XXXXXXXXXXXXX:key/1488f8c9-6443-4486-9927-8825278e3aad",
        "role": "${module.roles.bedrock_agent_lambda_role_arn}",
        "code_signing_config_arn": "${aws_lambda_code_signing_config.this.arn}",
        "reserved_concurrent_executions": -1,
        "timeout": 300,
        "publish": true,
        "s3_bucket": "<BUCKET-NAME>",
        "s3_key": "package.zip",
        "package_type": "Zip",
        "memory_size": 1024,
        "layers": [
          "arn:aws:lambda::017000801446:layer:AWSLambdaPowertoolsPythonV2:60"
        ],
        "tracing_config": [
          {
            "mode": "Active"
          }
        ],
        "dead_letter_config": [
          {
            "target_arn": "${aws_sqs_queue.bi_chatbot_container_lambda_dql.arn}"
          }
        ],
        "vpc_config": [
          {
            "subnet_ids": [
              "subnet-0eb0b0e49448a5b49",
              "subnet-0f423fe837a1cfa22"
            ],
            "security_group_ids": [
              "${aws_security_group.lambda_group_lambda.id}"
            ]
          }
        ],
        "environment": [
          {
            "variables": {
              "MODEL_ID": "anthropic.claude-3-haiku-20240307-v1:0",
              "HAIKU_MODEL_ID": "anthropic.claude-3-haiku-20240307-v1:0",
              "GROUP_DATA_OBJECT_KEY": "group_data.json",
              "REPORT_DATA_OBJECT_KEY": "report_data.json",
              "FILTER_DATA_OBJECT_KEY": "fields.json",
              "MAPPING_DATA_OBJECT_KEY": "maps.json",
              "REQUEST_TEMPLATE_OBJECT_KEY": "request_template.json",
              "RESPONSE_TEMPLATE_OBJECT_KEY": "response_template.json",
              "FEW_SHOT_OBJECT_KEY": "examples.json",
              "GENERATE_FIELDS": "id fiscal lifeToDate from to from1 to1 trend compare pivot1 pivot2 pivot3 pivot4 pivot5 pivot6 pivot7 pivot8 pivot9 pivot10 pivot11 pivot12 filters sorts",
              "AGENT_DESCRIPTION": "You are a fitness chatbot",
              "AGENT_INSTRUCTIONS": "You are a helpful fitness assistant. You have general knowledge about sports. You can answer\nquestions related to fitness, diet plans. Use only the tools or knowledge base provided to answer\nuser questions. Choose between the tools or the knowledge base. Do not use both. Do not respond\nwithout using a tool or knowledge base.\nWhen a user asks to calculate their BMI:\n1. Ask for their weight in kilograms.\n2. Ask for their height in meters\n3. If the user provides values in any other unit, convert it into kilograms for weight and\nmeters for height. Do not make any comments about health status.",
              "ACTION_GROUP_AGENT_DESCRIPTION": "Use the action group to get the fitness plans, diet plans and historical details",
              "KB_INSTRUCTIONS_FOR_AGENT": "Use the knowledge base when the user is asking for a definition about a fitness, diet plans. Give a very detailed answer and cite the source."
            }
          }
        ],
        "has_security_groups": true,
        "sg_rules": [
          {
            "type": "egress",
            "from_port": 0,
            "to_port": 0,
            "protocol": -1,
            "cidr_blocks": [
              "0.0.0.0/0"
            ],
            "sg_id": "aws_security_group.lambda_group_lambda",
            "description": "Allow egress to all"
          }
        ],
        "iam_role_id": null
      },
      "parentId": "lambda",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_cloudwatch_log_group.lambda_log_group",
      "type": "resource",
      "data": {
        "resource_type": "aws_cloudwatch_log_group",
        "resource_name": "lambda_log_group",
        "resource_service": "cloudwatch",
        "resource_icon": "aws/Architecture-Service-Icons_07312025/Arch_Management-Governance/48/Arch_Amazon-CloudWatch_48.svg",
        "name": "/aws/lambda/${aws_lambda_function.bi_chatbot_container_lambda.function_name}",
        "retention_in_days": 365,
        "kms_key_id": "arn:aws:kms:us-west-2:XXXXXXXXXXXXX:key/1488f8c9-6443-4486-9927-8825278e3aad",
        "has_security_groups": false,
        "sg_rules": [],
        "iam_role_id": null
      },
      "parentId": "cloudwatch",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_vpc_endpoint.interface_endpoints",
      "type": "resource",
      "data": {
        "resource_type": "aws_vpc_endpoint",
        "resource_name": "interface_endpoints",
        "resource_service": "vpc",
        "resource_icon": "aws/Resource-Icons_07312025/Res_Networking-Content-Delivery/Res_Amazon-VPC_Endpoints_48.svg",
        "for_each": "${{for k , v in local.interface_endpoints : k => v if v.enabled}}",
        "vpc_id": "vpc-047dd28296946f67c",
        "service_name": "com.amazonaws..${each.value.service}",
        "vpc_endpoint_type": "Interface",
        "subnet_ids": [
          "subnet-0eb0b0e49448a5b49",
          "subnet-0f423fe837a1cfa22"
        ],
        "security_group_ids": [
          "${aws_security_group.endpoint_security_group.id}"
        ],
        "private_dns_enabled": true,
        "has_security_groups": true,
        "sg_rules": [
          {
            "type": "ingress",
            "from_port": 0,
            "to_port": 0,
            "protocol": -1,
            "cidr_blocks": [
              "172.16.5.0/24",
              "172.16.6.0/24"
            ],
            "sg_id": "aws_security_group.endpoint_security_group",
            "description": "Allow all ingress from VPC CIDR"
          },
          {
            "type": "egress",
            "from_port": 0,
            "to_port": 0,
            "protocol": -1,
            "cidr_blocks": [
              "0.0.0.0/0"
            ],
            "sg_id": "aws_security_group.endpoint_security_group",
            "description": "Allow egress to all"
          }
        ],
        "iam_role_id": null
      },
      "parentId": "vpc",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_vpc_endpoint.bedrock_interface_endpoints",
      "type": "resource",
      "data": {
        "resource_type": "aws_vpc_endpoint",
        "resource_name": "bedrock_interface_endpoints",
        "resource_service": "vpc",
        "resource_icon": "aws/Resource-Icons_07312025/Res_Networking-Content-Delivery/Res_Amazon-VPC_Endpoints_48.svg",
        "for_each": "${{for k , v in local.bedrock_interface_endpoints : k => v if v.enabled}}",
        "vpc_id": "vpc-047dd28296946f67c",
        "service_name": "com.amazonaws..${each.value.service}",
        "vpc_endpoint_type": "Interface",
        "subnet_ids": [
          "subnet-0eb0b0e49448a5b49",
          "subnet-0f423fe837a1cfa22"
        ],
        "security_group_ids": [
          "${aws_security_group.interface_group_lambda.id}"
        ],
        "private_dns_enabled": true,
        "has_security_groups": true,
        "sg_rules": [
          {
            "type": "ingress",
            "from_port": 0,
            "to_port": 0,
            "protocol": -1,
            "security_groups": [
              "${module.bedrock_agent.lambda_security_group_id}"
            ],
            "sg_id": "aws_security_group.interface_group_lambda",
            "description": "Allow calls only from Lambda Function",
            "cidr_blocks": null
          },
          {
            "type": "egress",
            "from_port": 0,
            "to_port": 0,
            "protocol": -1,
            "security_groups": null,
            "sg_id": "aws_security_group.interface_group_lambda",
            "description": "Allow egress to all",
            "cidr_blocks": [
              "0.0.0.0/0"
            ]
          }
        ],
        "iam_role_id": null
      },
      "parentId": "vpc",
      "position": {
        "x": 0,
        "y": 0
      }
    },
    {
      "id": "aws_opensearchserverless_vpc_endpoint.aoss_vpc_endpoints",
      "type": "resource",
      "data": {
        "resource_type": "aws_opensearchserverless_vpc_endpoint",
        "resource_name": "aoss_vpc_endpoints",
        "resource_service": "vpc",
        "resource_icon": "aws/Resource-Icons_07312025/Res_Networking-Content-Delivery/Res_Amazon-VPC_Endpoints_48.svg",
        "name": "aoss-vpc-endpoints",
        "subnet_ids": [
          "subnet-0eb0b0e49448a5b49",
          "subnet-0f423fe837a1cfa22"
        ],
        "vpc_id": "vpc-047dd28296946f67c",
        "has_security_groups": false,
        "sg_rules": [],
        "iam_role_id": null
      },
      "parentId": "vpc",
      "position": {
        "x": 0,
        "y": 0
      }
    }
  ],
  "edges": [
    {
      "source": "aws_lambda_function.bi_chatbot_container_lambda",
      "target": "aws_sqs_queue.bi_chatbot_container_lambda_dql",
      "data": {
        "type": "other-res-res",
        "label": [
          "dead_letter_config",
          "0",
          "target_arn"
        ]
      },
      "id": "other-res-res-aws_lambda_function.bi_chatbot_container_lambda-aws_sqs_queue.bi_chatbot_container_lambda_dql"
    },
    {
      "source": "aws_cloudwatch_log_group.lambda_log_group",
      "target": "aws_lambda_function.bi_chatbot_container_lambda",
      "data": {
        "type": "other-res-res",
        "label": [
          "name"
        ]
      },
      "id": "other-res-res-aws_cloudwatch_log_group.lambda_log_group-aws_lambda_function.bi_chatbot_container_lambda"
    }
  ]
}